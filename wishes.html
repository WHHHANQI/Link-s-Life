<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Link's Wishes</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .wish-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .wish-card-img { width: 100%; height: 150px; object-fit: cover; background: #eee; border-radius: 8px 8px 0 0; }
        .wish-info { padding: 15px; }
        .progress-bar { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); width: 0%; transition: 1s; }
        .add-form { display: none; margin-top: 10px; border-top: 1px dashed #ccc; padding-top: 10px; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="brand">Link's Life</div>
        <div class="nav-links">
            <a href="index.html">ğŸ  å…³äºæˆ‘</a>
            <a href="finance.html">ğŸ’° èµ„äº§è®°å½•</a>
            <a href="wishes.html" class="active">âœ¨ æ„¿æœ›å½±é›†</a>
        </div>
    </nav>

    <div class="container">
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2>âœ¨ æ„¿æœ›æ¸…å•</h2>
                <button onclick="toggleForm()">+ æ·»åŠ æ„¿æœ›</button>
            </div>
            
            <div id="addForm" class="add-form">
                <input id="wTitle" placeholder="æ„¿æœ›åç§°">
                <input id="wCost" type="number" placeholder="ç›®æ ‡é‡‘é¢ (é€‰å¡«ï¼Œä¸å¡«åˆ™ä¸ºæ— ä»·)">
                <input id="wImg" placeholder="å›¾ç‰‡URL">
                <button onclick="addNewWish()">ä¿å­˜</button>
            </div>
        </div>

        <div id="wishGrid" class="wish-grid"></div>
    </div>

    <script src="js/db.js"></script>
    <script src="js/lock.js"></script>

    <script>
        const db = new GithubDB();
        const FILE_NAME = "wishes.json";
        let localWishes = [];

        // ã€æ ¸å¿ƒä¿®æ”¹ã€‘ç­‰å¾…è§£é”ä¿¡å·
        window.addEventListener('app-ready', async () => {
            const data = await db.load(FILE_NAME);
            if(data) {
                localWishes = data;
                renderWishes();
            }
        });

        function toggleForm() {
            const form = document.getElementById('addForm');
            form.style.display = form.style.display === 'block' ? 'none' : 'block';
        }

        async function addNewWish() {
            const title = document.getElementById('wTitle').value;
            // å…è®¸ cost ä¸ºç©ºï¼Œé»˜è®¤ä¸º 0
            const cost = Number(document.getElementById('wCost').value) || 0; 
            const img = document.getElementById('wImg').value;
            
            if(!title) return alert("æ„¿æœ›åç§°å¿…é¡»å¡«å“¦");

            const newWish = { 
                id: Date.now(), 
                title, cost, img, current: 0 
            };
            
            localWishes.push(newWish);
            await db.save(FILE_NAME, localWishes);
            location.reload();
        }

        async function addDeposit(id) {
            const amount = Number(prompt("å­˜å…¥å¤šå°‘é’±ï¼Ÿ"));
            if(!amount) return;
            const wish = localWishes.find(w => w.id === id);
            if(wish) {
                wish.current += amount;
                await db.save(FILE_NAME, localWishes);
                renderWishes();
            }
        }

        function renderWishes() {
            const grid = document.getElementById('wishGrid');
            grid.innerHTML = "";
            
            localWishes.forEach(w => {
                let footerHtml = "";
                let progressHtml = "";

                // é€»è¾‘åˆ¤æ–­ï¼šå¦‚æœæœ‰é‡‘é¢ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡ï¼›å¦‚æœæ²¡é‡‘é¢ï¼Œæ˜¾ç¤ºâ€œæ— ä»·â€
                if (w.cost > 0) {
                    const pct = Math.min(100, (w.current / w.cost) * 100).toFixed(1);
                    progressHtml = `
                        <div class="progress-bar">
                            <div class="progress-fill" style="width:${pct}%"></div>
                        </div>`;
                    footerHtml = `
                        <div style="display:flex; justify-content:space-between; font-size:0.8rem;">
                            <span>å·²å­˜: Â¥${w.current}</span>
                            <span>${pct}%</span>
                        </div>
                        <button onclick="addDeposit(${w.id})" style="width:100%; margin-top:10px; background:#10b981;">ğŸ’° å­˜å…¥</button>
                    `;
                } else {
                    progressHtml = `<div style="margin:10px 0; color:#8b5cf6; font-weight:bold; font-size:0.9rem;">â™¾ï¸ Priceless (æ— ä»·)</div>`;
                    footerHtml = `<div style="font-size:0.8rem; color:#666;">æœ‰äº›æ¢¦æƒ³ä¸éœ€è¦æ ‡ä»·ï¼Œåªéœ€è¦å»å®ç°ã€‚</div>`;
                }
                
                grid.innerHTML += `
                    <div class="card" style="padding:0;">
                        <img src="${w.img || 'https://via.placeholder.com/300'}" class="wish-card-img">
                        <div class="wish-info">
                            <h3 style="margin:0 0 5px 0;">${w.title}</h3>
                            <p style="color:#666; font-size:0.9rem; margin:0;">ç›®æ ‡: ${w.cost > 0 ? 'Â¥'+w.cost : 'æ— ä»·'}</p>
                            ${progressHtml}
                            ${footerHtml}
                        </div>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>
