<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link's Success Journal</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* æ—¥è®°ä¸“å±æ ·å¼ï¼šä¿ç•™æ¢è¡Œç¬¦ï¼Œè®©æ’ç‰ˆæ›´åƒæ–‡ç«  */
        .journal-content {
            white-space: pre-wrap; 
            line-height: 1.6;
            color: #334155;
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .journal-date {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: bold;
            margin-bottom: 5px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 5px;
            display: flex; justify-content: space-between;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h2>ğŸ† ä»Šæ—¥æˆåŠŸæ—¥è®° (Today's Success)</h2>
            <p style="font-size: 0.8rem; color: #64748b;">
                æ¯å¤©è®°å½• 5 ä»¶åšæˆåŠŸçš„äº‹ï¼Œæ— è®ºå¤§å°ã€‚<br>
                Record at least 5 achievements daily, no matter how small.
            </p>
            
            <input id="dateInput" type="date">
            
            <textarea id="journalInput" rows="8" 
                style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-family: inherit;" 
                placeholder="1. è¯»äº†20é¡µä¹¦ (Read 20 pages)&#10;2. åšæŒè®°è´¦ (Tracked expenses)&#10;3. ..."></textarea>
            
            <button onclick="addJournal()" style="margin-top: 10px; width: 100%;">ğŸ’¾ ä¿å­˜æ—¥è®° (Save Journal)</button>
        </div>

        <div id="journalGrid">
            </div>
    </div>

    <script src="js/db.js"></script>
    <script src="js/lock.js"></script>

    <script>
        const db = new GithubDB();
        const FILE_NAME = "success_journal.json"; // ä¸“å±çš„æ•°æ®æ–‡ä»¶
        let localData = [];

        window.addEventListener('app-ready', async () => {
            document.getElementById('dateInput').valueAsDate = new Date();
            
            const data = await db.load(FILE_NAME);
            if(data) {
                localData = data;
                renderJournals();
            }
        });

        async function addJournal() {
            const date = document.getElementById('dateInput').value;
            const content = document.getElementById('journalInput').value;
            
            if(!content.trim()) return alert("å†™ç‚¹ä»€ä¹ˆå§ (Please write something)!");

            const newEntry = { 
                id: Date.now(), 
                date, 
                content 
            };
            
            // ç®€å•çš„é€»è¾‘ï¼šå¦‚æœåŒä¸€å¤©å·²ç»å†™è¿‡ï¼Œå°±è¿½åŠ å†…å®¹ï¼Œæˆ–è€…ä½ å¯ä»¥é€‰æ‹©è¦†ç›–
            // è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç›´æ¥æ·»åŠ åˆ°åˆ—è¡¨æœ€å‰é¢
            localData.push(newEntry);
            
            // æŒ‰æ—¥æœŸå€’åºæ’åº
            localData.sort((a,b) => new Date(b.date) - new Date(a.date));

            await db.save(FILE_NAME, localData);
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('journalInput').value = "";
            renderJournals();
        }

        function renderJournals() {
            const grid = document.getElementById('journalGrid');
            grid.innerHTML = "";
            
            localData.forEach(item => {
                grid.innerHTML += `
                    <div class="card">
                        <div class="journal-date">
                            <span>ğŸ“… ${item.date}</span>
                            <span style="cursor:pointer; color:#ef4444;" onclick="deleteJournal(${item.id})">Ã—</span>
                        </div>
                        <div class="journal-content">${item.content}</div>
                    </div>
                `;
            });
        }

        async function deleteJournal(id) {
            if(!confirm("ç¡®å®šåˆ é™¤å— (Delete this)?")) return;
            localData = localData.filter(i => i.id !== id);
            await db.save(FILE_NAME, localData);
            renderJournals();
        }
    </script>
    <script src="js/nav.js"></script> <script>
        renderNav('success'); 
    </script>
</body>
</html>
